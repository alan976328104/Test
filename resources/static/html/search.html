<!DOCTYPE html>
<html>

<head>
<meta charset="UTF-8">

<title>数据搜索</title>
<link href="../assets/css/font-awesome.min.css" rel="stylesheet">
<!--[if IE 7]>
    <link rel="stylesheet" href="../assets/css/font-awesome-ie7.min.css">
    <![endif]-->

<script src="../assets/js/jquery-1.9.1.min.js"></script>

<script src="../assets/js/alldata.js"></script>

<script type="text/javascript" src="jquery.min.js"></script>
<script type="text/javascript" src="pageoffice.js" id="po_js_main"></script>
<!--bootstrap-table-->
<script src="../assets/js/bootstrap/bootstrap-table.js"></script>
<link href="../assets/css/bootstrap/bootstrap-table.css" rel="stylesheet">
<script src="../assets/js/bootstrap/bootstrap-table-pagejump.js"></script>
<link href="../assets/css/bootstrap/bootstrap-table-pagejump.css" rel="stylesheet">
<script src="../assets/js/bootstrap/bootstrap.min.js"></script>
<link href="../assets/css/bootstrap/bootstrap-dialog.css" rel="stylesheet">
<script src="../assets/js/bootstrap/bootstrap-dialog.js"></script>

<link href="../assets/css/bootstrap/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="../assets/css/newstyle.css">
<script src="../assets/js/laydate/laydate.js"></script>
<link rel="stylesheet" href="../assets/css/zTreeStyle.css" type="text/css">
<script type="text/javascript" src="../assets/js/jquery.ztree.core.js"></script>
<script type="text/javascript" src="../assets/js/jquery.ztree.excheck.js"></script>
<script type="text/javascript" src="../assets/js/jquery.ztree.exedit.js"></script>

<style>
#ulsearch {
	margin: 0px;
	padding: 0px;
}

#ulsearch li {
	font-size: 14px;
	list-style: none;
	border: 1px solid #B0CDE6;
	/*padding: 3px;*/
	float: left;
	background: white;
	padding: 0px 2px;
	border-radius: 3px;
	margin-right: 5px;
}

select,input {
	/* color: #fff !important; */
}

.input-group-btn select {
	border-radius: 5px !important;
	background: none;
}

#inputadd,#search,#inputdel {
	background: #fff !important;
	color: #333;
}

#ul {
	
}

#div-dg {
	/* margin-top: 10px; */
}

#selectdiv i {
	
}

input[name='searchInput'] {
	border-radius: 5px !important;
	/* border-right: none; */
}

select[name='condition'] {
	width: auto;
	/* border-left: none; */
	top: 0px;
}

.form-group #inputadd:hover {
	color: #333 !important;
}

.clearfix {
	margin-top: 20px;
}

#twices {
	background: #fff !important;
	color: #000;
	width: 160px !important;
}

#twices[disabled] {
	background-color: #fff !important;
    border-color: #e6dede !important;
    color: #d5d0d0 !important;
}

#twices:hover {
	color: #000 !important;
}

#search2Input {
	border: 1px solid #ccc !important;
	border-radius: 5px;
	height: 33px;
	margin-right: 10px;
}

.input-group-btn select {
	border-left: 1px solid #fff;
}

input::-webkit-input-placeholder {
	color: #fff !important;
}

.input-group input {
	color: #333 !important;
	background: #fff;
}

.input-group select {
	color: #333 !important;
	margin-right: 7px;
	background: #fff;
}

/* .col-xs-7 {
	width: 25.3333%;
} */

.input-group input {
	margin-right: 7px;
}

button {
	/* background-color: #0085FF !important; */
}

.per-i {
	color: #CC7003;
}

.sys-i {
	color: #0085FF;
}
.sang_Calender{
background: #fff;
border-radius: 5px !important;
width:200px;
height: 32px;
padding: 5px;
font-size: 14px;
line-height: 1.428571429;
border: 1px solid #ccc;
color: rgb(51, 51, 51) !important;
}
#listsearch{
background: #fff !important;
}
</style>
<script th:inline="javascript">
//获取登录者信息
var sessionUser;
$.ajax({
	type : "post",
	url : "/getSessionByIp",
	async : false,
	success : function(data) {
		sessionUser=data
	}
})
var lang = getUrlParam("lang");
var columns,roleBtns;
var status=false;
//获取用户的操作权限
$.ajax({
	type : 'POST',
			url : "/getUserButton",
			data : {
				userId : sessionUser.userId
			},
			async : false,
			dataType : "json",
			success : function(data) {
				console.log(56)
				if(data!=null){
					roleBtns=data
					for(var i=0;i<data.length;i++){
						if(data[i].btnName=='系统标签'){
							status=true
						}
						
					}
				}
			}
		})
if (lang != "en_US") {
	columns = [ [
					{
						field : 'fileId',
						title : '#',
						width : '0.5%',
						cellStyle : function(row, index) {
							var style = {};
							style = {
								css : {
									'display' : 'none'
								}
							};
							return style;
						}
					},
					{
						field : 'check',
						checkbox : true,
						width : '0.5%',
						formatter : function(value, row, index) {
							if (row.check == true) {
								return {
									checked : true
								};
							}
						}

					},
					{
						title : '#',
						field : 'fileId',
						width : '0.5%',
						formatter : function(value, row, index) {
							return index + 1;
						}
					},
					{
						field : 'fileName',
						title : '名称',
						width : '22%',
						formatter : forma
					},
					{
						field : 'abstracts',
						title : '检索内容摘要',
						width : '20%'
					},
					{
						field : 'security.securityName',
						title : '密级',
						width : '3%'
					},
					{
						field : 'fileDate',
						title : '日期',
						sortable : true,
						width : '8%'
					},
					{
						field : 'fileVersion',
						title : '版本',
						width : '3%'
					},
					{
						field : 'alias',
						title : '系统标签',
						align : 'center',
						width : '10%',
						formatter : function(value, row, index) {
							var content = "";
							for (var i = 0; i < value.length; i++) {
								if (value[i].aliasType == 1) {
									content += "<i class='icon-tag sys-i'></i><span class='sys-i'>"
											+ value[i].aliasName
											+ "</span>";
								}
							}
							// if(sessionUser.role.roleId==1){
							  	content+="<i class='icon-plus' style='cursor: pointer;display: block;' onclick='plusAlias(this,1)'></i>";
							// }else{
							//	content += "<i class='icon-plus' style='cursor: pointer;display: block;color:#757575'></i>";
							// }
							return content;
						}
					},
					{
						field : 'alias',
						title : '个人标签',
						align : 'center',
						width : '10%',
						formatter : function(value, row, index) {
							var content = "";
							for (var i = 0; i < value.length; i++) {
								if (value[i].aliasType == 2) {
									content += "<i class='icon-tag per-i'></i><span class='per-i'>"
											+ value[i].aliasName
											+ "</span>";
								}
							}
						    content+="<i class='icon-plus' style='cursor: pointer;display: block;' onclick='plusAlias(this,2)'></i>";
							return content;
						}

					}, {
						field : 'location',
						title : '文件来源',
						width : '25%',
						formatter:formatUrl
					} ] ]
	document
	.write("<script src='../assets/js/bootstrap/bootstrap-table-zh-CN.js' >"
			+ "<" + "/script>");
}else{
	columns = [ [
					{
						field : 'fileId',
						title : '#',
						width : '0.5%',
						cellStyle : function(row, index) {
							var style = {};
							style = {
								css : {
									'display' : 'none'
								}
							};
							return style;
						}
					},
					{
						field : 'check',
						checkbox : true,
						width : '0.5%',
						formatter : function(value, row, index) {
							if (row.check == true) {
								return {
									checked : true
								};
							}
						}

					},
					{
						title : '#',
						field : 'fileId',
						width : '0.5%',
						formatter : function(value, row, index) {
							return index + 1;
						}
					},
					{
						field : 'fileName',
						title : 'FileName',
						width : '22%',
						formatter : forma
					},
					{
						field : 'abstracts',
						title : 'Retrieval Summary',
						width : '20%'
					},
					{
						field : 'security.securityName',
						title : 'Security',
						width : '3%'
					},
					{
						field : 'fileDate',
						title : 'Date',
						sortable : true,
						width : '8%'
					},
					{
						field : 'fileVersion',
						title : 'Version',
						width : '3%'
					},
					{
						field : 'alias',
						title : 'System Label',
						align : 'center',
						width : '10%',
						formatter : function(value, row, index) {
							var content = "";
							for (var i = 0; i < value.length; i++) {
								if (value[i].aliasType == 1) {
									content += "<p><i class='icon-tag sys-i'></i><span class='sys-i'>"
											+ value[i].aliasName
											+ "</span></p>";
								}
							}
							// if(sessionUser.role.roleId==1){
							  	content+="<p><i class='icon-plus' style='display: block;cursor: pointer;' onclick='plusAlias(this,1)'></i></p>";
							// }else{
							//content += "<i class='icon-plus' style='display: block;cursor: pointer;color:#757575'></i>";
							// }
							return content;
						}
					},
					{
						field : 'alias',
						title : 'Personal Label',
						align : 'center',
						width : '10%',
						formatter : function(value, row, index) {
							var content = "";
							for (var i = 0; i < value.length; i++) {
								if (value[i].aliasType == 2) {
									content += "<p><i class='icon-tag per-i'></i><span class='per-i'>"
											+ value[i].aliasName
											+ "</span></p>";
								}
							}
							 content+="<i class='icon-plus' style='cursor: pointer;display: block;' onclick='plusAlias(this,1)'></i>";
							return content;
						}

					}, {
						field : 'location',
						title : 'Location',
						width : '25%',
						formatter:formatUrl
					} ] ]
}
	var strHtml = '<div class="input-group" style="padding-left: 2px;float:left">'+
	//'<div style="display:inline">'+
	'<select name="searchSelect" onchange="firstSel(this)" class="form-control" style="width:auto;">'+
	'<option value="fileName">'+"[[#{fileName}]]"+'</option>'+
	'<option value="securityId">'+"[[#{filesec}]]"+'</option>'+
	'<option value="format">'+"[[#{format}]]"+'</option>'+
	'<option value="fileDate">'+"[[#{date}]]"+'</option>'+
	'<option value="alias">'+"[[#{alias}]]"+'</option>'+
	'<option value="item">'+"[[#{item}]]"+'</option>'+
	'<option value="fullSearch">'+"[[#{search}]]"+'</option>'+
	'<option value="basic">'+"[[#{attribute}]]"+'</option>'+
	'</select>'+
//	'</div>'+
	'<select name="children" class="form-control" style="width:auto;display:none" onchange="childrenSel(this)"></select>'
	strHtml=strHtml.replace(/'/g,"")
	strHtml+='<input type="text" class="form-control" placeholder='+"[[#{keyword}]]"+'  style="color: #333 !important; width: 250px;" name="searchInput" autocomplete="off">'+
	'<input type="text" style="display:none;border-radius: 5px !important;" class="sang_Calender" placeholder='+"[[#{pdate}]]"+' autocomplete="off" name="qBeginTime" />'+
	'<div name="menu" class="dropdown" style="display:none;" ><input type="text" name="aliasId" style="display:none" />'
	var str='<a name="aliasText" data-toggle="dropdown" class="btn"  data-target="#" style="margin-right: 10px;color:#000;border: 1px solid #ccc;background-color: #FFF !important;">'+"[[#{label}]]"+
	'<span class="caret" style="margin-left: 8px;color:#000"></span>  </a>'+
	'<ul name="categories" class="dropdown-menu"></ul></div>'+
	'<select name="children2" class="form-control" style="width:auto;display:none" onchange="childern2Sel(this)" ></select>'+
	'<span style="display:none"><input style="width:100px" name="inputStart" autocomplete="off" /><span style="color:#FFF">一 </span><input style="width:100px" name="inputEnd" autocomplete="off" /></span>'+
	'<span>'+
	'<select class="form-control" style="width:auto" name="condition">'+
	'<option value="0">'+"[[#{and}]]"+'</option><option value="1">'+"[[#{or}]]"+'</option></select></span></div>'
	str=str.replace(/'/g,"")
	strHtml+=str
	var inputall = [];
	var id = 0;
	var searchInput = document.getElementsByName("searchInput");
	var searchSelect = document.getElementsByName("searchSelect");
	var chSelect = document.getElementsByName("children");
	var condSelect = document.getElementsByName("condition");
	var qBeginTime = document.getElementsByName("qBeginTime");
	var aliasText = document.getElementsByName("aliasText");
	var aliasId = document.getElementsByName("aliasId");
	var categories = document.getElementsByName("categories");
	var children2 = document.getElementsByName("children2");
	var inputStart = document.getElementsByName("inputStart");
	var inputEnd = document.getElementsByName("inputEnd");
	var dataAlias;
	$(function() {
		dataAlias = aliasByUser();
		$("#selectdiv").append(strHtml);
		//点击添加按钮
		$("#inputadd")
				.click(
						function() {
							var strsHtml = '<div class="input-group" style="margin-top: 5px;padding-left: 2px;clear:both;">'+
							//'<div class="input-group-btn" style="margin-left:5px;">'+
							'<select name="searchSelect"  onchange="firstSel(this)" class="form-control" style="width:auto;">'+
							'<option value="fileName">'+"[[#{fileName}]]"+'</option>'+
							'<option value="securityId">'+"[[#{filesec}]]"+'</option>'+
							'<option value="format">'+"[[#{format}]]"+'</option>'+
							'<option value="fileDate">'+"[[#{date}]]"+'</option>'+
							'<option value="alias">'+"[[#{alias}]]"+'</option>'+
							'<option value="item">'+"[[#{item}]]"+'</option>'+
							'<option value="fullSearch">'+"[[#{search}]]"+'</option>'+
							'<option value="basic">'+"[[#{attribute}]]"+'</option>'+
							'</select>'+
						//	'</div>'+
							'<select name="children" class="form-control" style="width:auto;display:none" onchange="childrenSel(this)"></select>'
							strsHtml=strsHtml.replace(/'/g,"")
							strsHtml+='<input type="text" class="form-control" placeholder='+"[[#{keyword}]]"+'  style="color: #333 !important; width: 250px;" name="searchInput" autocomplete="off">'+
							'<input type="text" style="display:none;border-radius: 5px !important;" class="sang_Calender" placeholder='+"[[#{pdate}]]"+' autocomplete="off" name="qBeginTime" />'+
							'<div name="menu" class="dropdown" style="display:none;" ><input type="text" name="aliasId" style="display:none" />'
							var str='<a name="aliasText" data-toggle="dropdown" class="btn" data-target="#" style="margin-right: 10px;color:#000;border: 1px solid #ccc;background-color: #FFF !important;">'+
							''+"[[#{label}]]"+'<span class="caret" style="margin-left: 5px;color:#000"></span>  </a>'+
							'<ul name="categories" class="dropdown-menu"></ul></div>'+
							'<select name="children2" class="form-control" style="width:auto;display:none" onchange="childern2Sel(this)" ></select>'+
							'<div style="display:none"><input style="width:100px" autocomplete="off"/><span style="color:#FFF">一 </span><input style="width:100px" autocomplete="off"/></div>'+
							'<span>'+
							'<select class="form-control" style="width:auto" name="condition">'+
							'<option value="0">'+"[[#{and}]]"+'</option>'+
							'<option value="1">'+"[[#{or}]]"+'</option>'+
							'</select></span>'+
							'<button class="btn btn-default" id="inputdel" title='+"[[#{reduceSearch}]]"+' type="button"><i class="icon-minus"></i></button></div>'
							str=str.replace(/'/g,"")
							strsHtml+=str
							$("#selectdiv").append(strsHtml);
						});

		$("#div-dg").hide();
		//点击搜索按钮
		$("#search").click(function() {
			search('/pageSearch');
		})
		//结果中搜索
		$("#twices").click(function() {
			$("#searchModel").modal("show");
			//search('/page2Search');
		})
		
		//移除添加的搜索条件
		$('div').on('click', '#inputdel', function() {
			$(this).parent().remove();
		})
		var index = 0;
		var resultState=false;
		//搜索按钮点击事件
		$("#listsearch").click(function() {
					inputall = [];
					var searchVal = "";
					if ($("#search2Input").val() != "") {
						console.log(1)
						searchVal = $("#search2Input").val();
					} else if ($("#children").val() != ""
							&& $("#children").val() != null) {
						console.log(2)
						searchVal = $("#children").val();
					} else if ($("#q2BeginTime").val() != "") {
						console.log(3)
						searchVal = $("#q2BeginTime").val();
					} else if ($("#alias2Id").val() != "") {
						searchVal = $("#alias2Id").val();
						console.log(searchVal)
					}else{
						
					}
					inputall.push({
						"searchName" : $("#search2Select").val(),
						"searchVal" : searchVal,
						"condSelect" : ""
					});
					index++;
					console.log(inputall)
					var str = "";
					for (var i = 0; i < inputall.length; i++) {
						if(inputall[i].searchName=="alias"){
							str += "<li>" + $("#alias2Text").text() + "</li>";
						}else{
							str += "<li>" + inputall[i].searchVal + "</li>";
						}
					}
					/* if(resultState){
						$("#ulsearch li:last").remove();
					} */
					$('#ulsearch').append(str);
					$("#tb_order").bootstrapTable('destroy');
					dataTable('/page2Search', inputall);
					$("#searchModel").modal("hide");
					resultState=true
				})
				if(roleBtns!=null){
					console.log(roleBtns)
					for(var i=0;i<roleBtns.length;i++){
						if(roleBtns[i].btnName=='下载'){
							$("#btn_down").css("display", "");
						}
					}
				}
	});
	//二层的下拉框选中事件
	function first2Sel(province) {
		var node = document.getElementById("children");
		var disNode = document.getElementById("search2Input");
		var date = document.getElementById("q2BeginTime");
		var aliasNode = document.getElementById("menu");
		if (province.value == "securityId") {//选择文档密级
			node.style.display = "";
			date.style.display = "none";
			disNode.style.display = "none";
			aliasNode.style.display = "none";
			selData("/getSecurityAll", node, 0);
			disNode.value=""
			$("#q2BeginTime").val("")
			$("#alias2Text").val("")
			$("#alias2Id").val("")
		} else if (province.value == "format") {//文档格式
			node.style.display = "";
			date.style.display = "none";
			disNode.style.display = "none";
			aliasNode.style.display = "none";
		//	selData("/listFormatAll", node, 1);
			disNode.value=""
			$("#q2BeginTime").val("")
			$("#alias2Text").val("")
			$("#alias2Id").val("")
			var formatData=["in","iva","ivp","jpg","opi","out","pdf","pptx","rar","ric","shl","txt","tyc","wmv","xls","xlsx","zip","doc","docx"]
			var option;
				$.each(formatData, function(i, n) {//循环，i为下标从0开始，n为集合中对应的第i个对象
						option += "<option value='"+n+"'>" + n
								+ "</option>"
				});
			node.innerHTML = option;
		} else if (province.value == "item") {//项目
			node.style.display = "";
			date.style.display = "none";
			disNode.style.display = "none";
			aliasNode.style.display = "none";
			selData("/getUserMenu", node, 2);
			disNode.value=""
			$("#q2BeginTime").val("")
			$("#alias2Text").val("")
			$("#alias2Id").val("")
		} else if (province.value == "fileDate") {//日期
			date.style.display = "";
			node.style.display = "none";
			disNode.style.display = "none";
			aliasNode.style.display = "none";
			disNode.value=""
			node.value=""
			$("#alias2Text").val("")
			$("#alias2Id").val("")
		} else if (province.value == "alias") {//标签
			disNode.style.display = "none";
			date.style.display = "none";
			node.style.display = "none";
			aliasNode.style.display = "inline";
			disNode.value=""
			node.value=""
			$("#q2BeginTime").val("")
		} else {
			disNode.style.display = "";
			date.style.display = "none";
			node.style.display = "none";
			aliasNode.style.display = "none";
			date.value = "";
			node.value = "";
			$("#alias2Text").val("")
			$("#alias2Id").val("")
		}
	}
	//二层下拉框数据加载
	 function childrenSel(node){
		$.ajax({
			type : 'POST',
			url : '/getInfoList',
			async : true,
			dataType:"json",
			success : function(data) {
				console.log(data)
				var basicOption;
				basicOption += "<option value=''>请选择</option>"
				$.each(data, function(i, n) {//循环，i为下标从0开始，n为集合中对应的第i个对象
					if(node.value==n.value){
						console.log(n.children)
						$.each(n.children, function(j, k) {//循环，i为下标从0开始，n为集合中对应的第i个对象
							basicOption += "<option value='"+k.name+"'>"
											+ k.name + "</option>"
													
						});
					}
				});
				node.nextSibling.nextSibling.nextSibling.nextSibling.nextSibling.style.display="none"
				node.nextSibling.nextSibling.nextSibling.nextSibling.innerHTML = basicOption;
			}})
	
	}
	//一层的下拉框选中事件
	function firstSel(province) {
		//var node = province.parentNode.nextSibling;
		var node = province.nextSibling;
		var disNode = node.nextSibling;
		var date = disNode.nextSibling;
		var aliasNode = date.nextSibling;
		var basicNode = aliasNode.nextSibling;
		var child2Node = basicNode.nextSibling;
		if (province.value == "securityId") {//选择文档密级
			node.style.display = "";
			date.style.display = "none";
			disNode.style.display = "none";
			aliasNode.style.display = "none";
			basicNode.style.display = "none";
			child2Node.style.display = "none";
			date.value=''
			disNode.value=''
			aliasNode.firstChild.value=''
			selData("/getSecurityAll", node, 0,"");
		} else if (province.value == "format") {//文档格式
			node.style.display = "";
			date.style.display = "none";
			disNode.style.display = "none";
			aliasNode.style.display = "none";
			basicNode.style.display = "none";
			child2Node.style.display = "none";
			date.value=''
			disNode.value=''
			aliasNode.firstChild.value=''
		//	selData("/listFormatAll", node, 1,"");
			var formatData=["in","iva","ivp","jpg","opi","out","pdf","pptx","rar","ric","shl","txt","tyc","wmv","xls","xlsx","zip","doc","docx"]
			var option;
				$.each(formatData, function(i, n) {//循环，i为下标从0开始，n为集合中对应的第i个对象
						option += "<option value='"+n+"'>" + n
								+ "</option>"
				});
			node.innerHTML = option;
		} else if (province.value == "basic") {//基本属性检索
			node.style.display = "";
			date.style.display = "none";
			disNode.style.display = "none";
			aliasNode.style.display = "none";
			basicNode.style.display = "";
			child2Node.style.display = "none";
			date.value=''
			disNode.value=''
			aliasNode.firstChild.value=''
			selData("/getInfoList",node,3,basicNode)
		}else if (province.value == "item") {//项目
			node.style.display = "";
			date.style.display = "none";
			disNode.style.display = "none";
			aliasNode.style.display = "none";
			basicNode.style.display = "none";
			child2Node.style.display = "none";
			date.value=''
			disNode.value=''
			aliasNode.firstChild.value=''
			selData("/getUserMenu", node, 2,"");
		}else if (province.value == "fileDate") {//日期
			date.style.display = "";
			node.style.display = "none";
			disNode.style.display = "none";
			aliasNode.style.display = "none";
			basicNode.style.display = "none";
			child2Node.style.display = "none";
			layDate();
			node.value=''
			disNode.value=''
			aliasNode.firstChild.value=''
		} else if (province.value == "alias") {//标签
			disNode.style.display = "none";
			date.style.display = "none";
			node.style.display = "none";
			basicNode.style.display = "none";
			child2Node.style.display = "none";
			aliasNode.style.display = "inline";
			aliasNode.lastChild.innerHTML=''
			$(aliasNode.lastChild).append(dataAlias);
			node.value=''
			disNode.value=''
			date.value=''
		} else {
			disNode.style.display = "";
			date.style.display = "none";
			node.style.display = "none";
			aliasNode.style.display = "none";
			basicNode.style.display = "none";
			child2Node.style.display = "none";
			console.log(date)
			node.value=''
			date.value=''
			aliasNode.firstChild.value=''
		}
	}
	//基本属性的三层下拉框事件
	function childern2Sel(node){
		console.log(node)
		var range= node.nextSibling;
		if(node.value!=""){
			range.style.display = "inline";
		}else{
			range.style.display = "none";
		}
	}
	//
	function selData(url, node, index,childrenNode) {
		var option;
	//	var prData=[{"text":"不同流量试验","children":[{"text":"DaN"},{"text":"MW/h"}]},{"text":"不用高度试验","children":[{"text":"12MPa"},{"text":"12m3/h"}]}]
		if(url!=""){
			$.ajax({
				type : 'POST',
				url : url,
				data:{userId:sessionUser.userId},
				async : true,
				dataType:"json",
				success : function(data) {
					if (index == 0) {
						$.each(data, function(i, n) {//循环，i为下标从0开始，n为集合中对应的第i个对象
							option += "<option value='"+n.securityName+"'>"
									+ n.securityName + "</option>"
						});
					} else if(index==1){
						if (data != null) {
							$.each(data, function(i, n) {//循环，i为下标从0开始，n为集合中对应的第i个对象
								option += "<option value='"+n+"'>" + n
										+ "</option>"
							});
						}
					}else if(index==2){
						if (data != null) {
							console.log(data[0])
							var childrenData=[];
							//console.log(getChildrenMenu(data[0].children,childrenData))
							//$.each(data[0].children, function(i, n) {//循环，i为下标从0开始，n为集合中对应的第i个对象
								$.each(getChildrenMenu(data[0].children,childrenData), function(j, k) {//循环，i为下标从0开始，n为集合中对应的第i个对象
										option += "<option value='"+k.text+"'>" + k.text
										+ "</option>"
								});
							//});
						}
					}else if(index==3){
						if (data != null) {
							$.each(data, function(i, n) {//循环，i为下标从0开始，n为集合中对应的第i个对象
								option += "<option value='"+n.value+"'>" + n.value
								+ "</option>"
							});
							var basicOption;
							basicOption += "<option value=''>请选择</option>"
							$.each(data[0].children, function(j, k) {//循环，i为下标从0开始，n为集合中对应的第i个对象
								basicOption += "<option value='"+k.name+"'>"
												+ k.name + "</option>"
														
							});
							childrenNode.innerHTML=basicOption
						}
					}
					node.innerHTML = option;//将循环拼接的字符串插入第二个下拉列表
				}
			});
		}
	}
	
	function getChildrenMenu(array,data){
		for(var i=0;i<array.length;i++){
			if(array[i].children.length>0){
				getChildrenMenu(array[i].children,data)
			}else{
				 if(array[i].url=="html/tab3.html"){
					 data.push(array[i])
				}
			}
		}
		return data;
	}
	function minusSearch(info, index) {
		var child = info.parentNode
		var pNode = document.getElementById("selectdiv");
		pNode.removeChild(child);
		inputall.splice(index, 1);
	}
	function search(searchUrl) {
		inputall = [];
		var lun = true;
		for (var i = 0; i < searchInput.length; i++) {
			if (searchInput[i].value != "") {//文本框没有值
				if (searchSelect[i] != undefined) {
					lun = false;
					inputall.push({
						"searchName" : searchSelect[i].value,
						"searchVal" : searchInput[i].value,
						"condSelect" : condSelect[i].value
					});
				}
			} else if (qBeginTime[i].value != ""
					&& qBeginTime[i].value != "请选择日期") {
				if (searchSelect[i] != undefined) {
					console.log("日期")
					inputall.push({
						"searchName" : searchSelect[i].value,
						"searchVal" : qBeginTime[i].value,
						"condSelect" : condSelect[i].value
					});
				}
			} else if (chSelect[i].value != "") {//选择框
				if (searchSelect[i] != undefined) {
					console.log("选择框")
					if(searchSelect[i].value=="basic"){
						if(children2[i].value!=""){
							inputall.push({
								"searchName" : searchSelect[i].value,
								"searchVal" : chSelect[i].value,
								"rangeVal" : children2[i].value,
								"inputStart" : inputStart[i].value,
								"inputEnd":inputEnd[i].value,
								"condSelect" : condSelect[i].value
							});
						}else{
							inputall.push({
								"searchName" : searchSelect[i].value,
								"searchVal" : chSelect[i].value,
								"condSelect" : condSelect[i].value
							});
						}
					}else{
						inputall.push({
							"searchName" : searchSelect[i].value,
							"searchVal" : chSelect[i].value,
							"condSelect" : condSelect[i].value
						});
					}
				}
			} else if (aliasText[i].innerText != "") {//标签
				console.log("标签")
				console.log(aliasId[i].value)
				inputall.push({
					"searchName" : searchSelect[i].value,
					"searchVal" : aliasId[i].value,
					"condSelect" : condSelect[i].value
				});
			}
		}
		console.log(inputall)
		//if (inputall.length != 0) {
		var str = "";
		for (var i = 0; i < inputall.length; i++) {
			if (inputall[i].searchVal != "") {
				console.log(inputall[i].searchName)
				if(inputall[i].searchName=="alias"){
					str += "<li>" + aliasText[i].innerText + "</li>";
				}else if(inputall[i].searchName=="basic"){
					console.log(inputall[i].inputStart)
					if(inputall[i].inputStart!=undefined&&inputall[i].inputStart!=""&&inputall[i].inputEnd!=undefined&&inputall[i].inputEnd!=""){
						str += "<li>" + inputall[i].searchVal + "</li>";
						str += "<li>" + inputall[i].rangeVal + "</li>";
						str += "<li>" + inputall[i].inputStart + "</li>";
						str += "<li>" + inputall[i].inputEnd + "</li>";
					}else{
						str += "<li>" + inputall[i].searchVal + "</li>";
					}
				}else{
					str += "<li>" + inputall[i].searchVal + "</li>";
				}
			}
		}
		$('#ulsearch').html(str);
		$("#div-dg").show();
		$("#tb_order").bootstrapTable('destroy');
		 if (inputall.length != 0) {
			inputall[inputall.length - 1].condSelect = "";
			/* for(var i=0;i<inputall.length;i++){
				if(inputall[i].searchName=='basic'&&inputall[i].rangeVal!=undefined){
					if(inputall[i].inputStart==undefined||inputall[i].inputEnd==undefined){
						console.log("您未填写搜索条件")
						searchNullErr();
					}
				}
			} */
		} 
		dataTable(searchUrl, inputall);
		//} else {
		//	$.showErr("您未填写搜索条件");
		//}
		
	}
	//加载表格
	function dataTable(searchUrl, inputResult) {
		console.log(inputResult)
		$('#tb_order')
				.bootstrapTable(
						{
							url : searchUrl,
							method : 'post', //请求方式（*）
							contentType : 'application/x-www-form-urlencoded',//post请求的话就加上这个句话
							//toolbar : '#toolbar', //工具按钮用哪个容器
							cache : false, // 是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
							pagination : true, //是否显示分页（*）
							paginationShowPageGo: true,
							pageNumber : 1, //初始化加载第一页，默认第一页
							pageSize : 10, //每页的记录行数（*）
							pageList : [ 10, 15, 20 ,30,50], //可供选择的每页的行数（*）
							clickToSelect : true, //是否启用点击选中行
							//sortable : false, //是否启用排序
							//sortOrder : "asc", //排序方式
							//showRefresh : true, //显示刷新按钮 
							sidePagination : "server", //分页方式：client客户端分页，server服务端分页（*）
							queryParamsType : '',
							queryParams : function(params) {//自定义参数，这里的参数是传给后台的，我这是是分页用的
								return {//这里的params是table提供的
									inputall : JSON.stringify(inputResult),
									sortOrder:this.sortOrder,
									pageNumber : params.pageNumber,
									pageSize : params.pageSize
								};
							},
							columns : columns
						});
		for(var i=0;i<inputResult.length;i++){
			if(inputResult[i].searchName=='fullSearch'||inputResult[0].searchName=='fullSearch'){
				$('#tb_order').bootstrapTable('showColumn','abstracts')
			}else{
				$('#tb_order').bootstrapTable('hideColumn','abstracts')
			}
		}
		$('#tb_order').children().children().children('th').eq(0).css(
				"display", "none")
				
		$("#tb_order").on('load-success.bs.table',function(data){
			console.log($('#tb_order').bootstrapTable('getData').length)
			if($('#tb_order').bootstrapTable('getData').length>0){
				document.getElementById("twices").disabled = false
			}else{
				document.getElementById("twices").disabled = true
			}
		});
	}

	function checkClick(aaa) {
		if (!aaa.checked) {
			aaa.parentNode.remove();
		}
	}

	function pagerFilter(data) {
		if (typeof data.length == 'number' && typeof data.splice == 'function') {
			data = {
				total : data.length,
				rows : data
			}
		}
		var dg = $(this);
		var opts = dg.datagrid('options');
		var pager = dg.datagrid('getPager');
		pager.pagination({
			onSelectPage : function(pageNum, pageSize) {
				opts.pageNumber = pageNum;
				opts.pageSize = pageSize;
				pager.pagination('refresh', {
					pageNumber : pageNum,
					pageSize : pageSize
				});
				dg.datagrid('loadData', data);
			}
		});
		if (!data.originalRows) {
			if (data.rows)
				data.originalRows = (data.rows);
			else if (data.data && data.data.rows)
				data.originalRows = (data.data.rows);
			else
				data.originalRows = [];
		}
		var start = (opts.pageNumber - 1) * parseInt(opts.pageSize);
		var end = start + parseInt(opts.pageSize);
		data.rows = (data.originalRows.slice(start, end));
		return data;
	}

	function formasorter(a, b) {
		a = a.split('-');
		b = b.split('-');
		if (a[2] == b[2]) {
			if (a[0] == b[0]) {
				return (a[1] > b[1] ? 1 : -1);
			} else {
				return (a[0] > b[0] ? 1 : -1);
			}
		} else {
			return (a[2] > b[2] ? 1 : -1);
		}
	}

	function forma(value, row, index) {
		if (row.fileName) {
			var namestr=row.fileName;
			for(var i=0;i<inputall.length;i++){
				if(inputall[i].searchName=='fileName'){
					var array = namestr.split(inputall[i].searchVal);
					/* if(array.length<2){
						array= namestr.split(inputall[i].searchVal.toLowerCase());
					}if(array.length<2){
						array= namestr.split(inputall[i].searchVal.toUpperCase());
					}
					console.log(array) */
					//var result = "";
					//if(namestr.indexOf(inputall[i].searchVal.toLowerCase())>0){
					namestr="";
					for(var j = 0;j<array.length;j++){
						if(j==array.length-1){
							namestr+=array[j]
						}else{
							namestr+=array[j]+"<span style='color:red;'>"+inputall[i].searchVal+"</span>"
						}
					}
					//namestr = array[0]+"<span style='color:red;'>"+inputall[i].searchVal+"</span>"+array[1];
				}
			}
			return "<a style='color: #1963AA;text-decoration: none;' href='javascript:void(0)' target='_blank' onclick='showfile(this)'>"
					+ namestr+ "<a/>";
		}
	}

	function forma1(value, row, index) {
		return "<a style='color:blue' href=''>下载</a>  <a style='color:blue' href='' class='coll'>收藏</a>";
	}
	function formatUrl(value, row, index){
		if(row.location!=null&&row.location!=""){
			var str=row.location.replace(/>/g,"<span style='color:blue'>➜</span>");
			//console.log(str)
			str=str.replace(/→/g,"<span style='color:blue'>➜</span>")
			return str;
		}
	}
	function showfile(file) {
		var fileId = $(file).parent().parent().children('td').eq(0).text();
		var secName = $(file).parent().parent().children('td').eq(4).text();
		var fileName = file.innerText;
		var fileSize=$(file).parent().parent().children('td').eq(8).text();
		var filestr = fileName.substr(0, fileName.lastIndexOf(".") + 1);
		var fileType = fileName.replace(filestr, "");
		var text;
		for (var i = 0; i < inputall.length; i++) {
			if (inputall[i].searchName == "1") {
				text = inputall[i].searchVal;
			}
		}
	 if (sessionUser.secretlevel == "B") {
		var cont = updateCount(fileId);
		if (cont) {
			openFile(fileType, fileId,fileSize);
		}
	} else if (sessionUser.secretlevel == "C") {
		if (secName != "机密") {
			var cont = updateCount(fileId);
			if (cont) {
				openFile(fileType, fileId,fileSize);
			}
		} else {
			roleErr()
		}
	} else if (sessionUser.secretlevel == "D") {
		if (secName == "非密") {
			var cont = updateCount(fileId);
			if (cont) {
				openFile(fileType, fileId,fileSize);
			}
		} else {
			roleErr()
		}
	} 
	}
	function updateCount(fId) {
		var isSuccess;
		$.ajax({
			type : 'POST',
			url : "/updateCounts",
			async : false,
			data : {
				userId : sessionUser.userId,
				fileId : fId
			},
			success : function(data) {
				if (data != null && data > 0) {
					isSuccess = data;
				} else {
					isSuccess = 0;
				}
			}
		})
		return isSuccess;
	}
	var pageofficeHeight= window.screen.height
	var pageofficeWidth= window.screen.width
	console.log(pageofficeHeight)
	function openFile(fileType, fileId,fileSize) {
		if (fileType == "pdf") {
			POBrowser.openWindowModeless("/pdf?fileId=" + fileId,"width="+pageofficeWidth+"px;height="+pageofficeHeight+"px;");
		} else if (fileType == "xls" || fileType == "xlsx") {
			window.open("/office?url=html/list.html&fileId="+fileId,'newwindow', 'height='+(pageofficeHeight-150)+', width='+(pageofficeWidth-150)+', toolbar=no, menubar=no,scrollbars=no, resizable=no,location=n o, status=no');
		} else if (fileType == "doc" || fileType == "docx" ||fileType == "ppt" || fileType == "pptx") {
			POBrowser.openWindowModeless("/word?type=0&fileId=" + fileId,
					"width="+pageofficeWidth+"px;height="+pageofficeHeight+"px;");
		}else if(fileType == "csv") {
			window.open('html/OpenCSV.html?fileId=' + fileId+'&type=0','newwindow', 'height=600, width=800,top=100, left=300, toolbar=no, menubar=no,scrollbars=no, resizable=no,location=n o, status=no');
		}else if(fileType == "txt"||fileType == "TXT"||fileType == "OUT"||fileType == "out"||fileType == "ric"||fileType == "RIC"||fileType == "bin"||fileType == "BIN"){
			window.open('html/Opentxt.html?fileId='+fileId,'newwindow', 'height=500, width=500,top=100, left=300, toolbar=no, menubar=no,scrollbars=no, resizable=no,location=n o, status=no');
		}else if(fileType =="jpg"||fileType =="JPG"||fileType =="PNG"||fileType =="png"){
			 window.open("/openJpg?fileId="+fileId,'newwindow', 'height=500, width=500,top=100, left=300, toolbar=no, menubar=no,scrollbars=no, resizable=no,location=n o, status=no');
		}else if(fileType =="MP4"||fileType =="mp4"||fileType =="wmv"||fileType =="WMV"){
			 window.open("html/OpenVideo.html?fileId="+fileId,'newwindow', 'height=500, width=500,top=100, left=300, toolbar=no, menubar=no,scrollbars=no, resizable=no,location=n o, status=no');
		}else{
			$("#notOpenModel").modal("show");
		}
	}

	function aliasByUser() {
		var aliasData;
		$.ajax({
			type : 'POST',
			url : "/aliasByUser",
			data : {
				userId : sessionUser.userId
			},
			async : false,
			success : function(data) {
				var result = createCategoryTree(data);
				aliasData = result;
				$("#categories").append(result);
			}
		})
		return aliasData;
	}
	var glb_str = "";
	function createCategoryTree(data) {
		var flag;
		for (var i = 0; i < data.length; i++) {
			var nodeText = data[i]['aliasName'];
			var nodeId = data[i]['aliasId'];
			var children = data[i]['children'];
			//若有子分类，则遍历子分类
			if (children.length > 0) {
				flag = true;
				glb_str += "<li class='offset-right dropdown-submenu'><a class='category' " + "id=" + nodeId + " href='#'>"
						+ nodeText + "</a><ul class='dropdown-menu'>"
				createCategoryTree(children);
			} else {
				//若没有子分类
				flag = false;
				glb_str += "<li><a class='category' " + "id=" + nodeId
						+ " href='#' onclick='shows($(this),$(this).text(),"
						+ nodeId + ")'>" + nodeText + "</a>";
			}
			if (flag) {
				glb_str += "</ul></li>"
			} else {
				glb_str += "</li>";
			}
		}
		return glb_str;
	}
	function shows(node, text, id) {
		getPartent(node, text, id);
	}
	function getPartent(node, text, id) {
		if (node[0].tagName != "DIV") {
			getPartent($(node).parent(), text, id);
		} else {
			console.log(id)
			node.children().eq(0).val(id);
			text += '<span class="caret" style="margin-left: 5px;color:#000"></span>';
			node.children().eq(1).html(text);
		}
	}
function layDate(){
	var script = document.createElement('script');
	script.setAttribute('type','text/javascript');
	script.setAttribute('src','../assets/js/datetime.js');
	document.getElementsByTagName('head')[0].appendChild(script);
}
function plusAlias(info, type) {
	var fileId = $(info).parent().parent().eq(0).children(0).eq(0).text();
	$("#aliasFileId").val(fileId);
	$("#aliasType").val(type);
	$("#labelVal").val("");
	aliasByUser();
	aliasByUserShow(type)
	var aliasTable=document.getElementById('tb_alias')
	if(type=='1'&&status=='false'){
		console.log(13)
		aliasTable.rows[0].style.display="none"
		aliasTable.rows[1].style.display=""
	}else{
		aliasTable.rows[1].style.display="none"
	}
	$("#aliasModel").modal("show");
}
var setting = { //此处根据自己需要进行配置
		view : {
			selectedMulti : false, //设置是否能够同时选中多个节点
			showIcon : false, //设置是否显示节点图标
			showLine : true, //设置是否显示节点与节点之间的连线
			showTitle : false, //设置是否显示节点的title提示信息
		},
		data : {
			simpleData : {
				enable : true
			},
			key : {
				url : "xUrl",
				icon : "menuIcon"
			}
		},
		check : {
			enable : true,
			//设置是否显示checkbox复选框
			chkStyle : "radio", //单选框
			radioType : "all" //对所有节点设置单选
		},
		callback : {
			onClick: onClick,
            onCheck: onCheckAlias,
            onMouseUp:treeUp
		}
	};
 function aliasByUserShow(type) {
	$
			.ajax({
				type : 'POST',
				url : "/aliasByUser",
				data : {
					userId : sessionUser.userId
				},
				success : function(data) {
					if (data != null) {
						data = JSON.parse(JSON.stringify(data).replace(/aliasName/g,
						"name"));
						 data=getChildren(data);
							document.getElementById('myalias').innerHTML = ""
								if (type == 1) {
									document.getElementById('myalias').innerHTML += '<span onclick="attention(this,1)" title="系统标签" style="border-radius: 5px;padding:3px;margin-right:5px;background-color:#C2E1EF;cursor:pointer">'
										+ data[0].name + '</span>';
									$.fn.zTree.init($("#systree"), setting,data[0].children);
							} else {
								document.getElementById('myalias').innerHTML += '<span onclick="attention(this,2)" title="个人标签" style="background-color:#EFEDC2;border-radius: 5px;padding:3px;margin-right:5px;cursor:pointer">'
										+ data[1].name + '</span>';
									$.fn.zTree.init($("#pertree"), setting,data[1].children);
							}
						if (data.length != 0) {
						} else {
							document.getElementById('aliasUser').style.display = "none"
						}
					}
				}
			})
} 
function treeUp(action,objId,data){
	/* var pertreeobj = $.fn.zTree.getZTreeObj("pertree");
	pertreeobj.cancelSelectedNode();
	var systreeobj = $.fn.zTree.getZTreeObj("systree");
	systreeobj.cancelSelectedNode(); */
}
// 树的单击事件
function onClick(event, treeId, treeNode) {
	var str=treeNode.tId
	var treeName=str.substring(0,str.indexOf("_")) 
	if(treeName=="pertree"){
		var zTreeObj = $.fn.zTree.getZTreeObj("pertree");
		$("#labelVal").val(zTreeObj.getSelectedNodes()[0].name);
		$("#aliaslistgeren").modal("hide");
	}else if(treeName=="systree"){
		var zTreeObj = $.fn.zTree.getZTreeObj("systree");
		if(status=='false'){
			 document.getElementById("selectAliasName").innerText=zTreeObj.getSelectedNodes()[0].name;
		}else{
			$("#labelVal").val(zTreeObj.getSelectedNodes()[0].name);
		}
		$("#aliaslistxitong").modal("hide");
	}
}
function onCheckAlias(e, treeId, treeNode) {
	var str=treeNode.tId
	var treeName=str.substring(0,str.indexOf("_")) 
	if(treeName=="pertree"){
		var zTreeObj = $.fn.zTree.getZTreeObj("pertree");
		$("#labelVal").val(zTreeObj.getSelectedNodes()[0].name);
		$("#aliaslistgeren").modal("hide");
	}else if(treeName=="systree"){
		var zTreeObj = $.fn.zTree.getZTreeObj("systree");
		if(status=='false'){
			document.getElementById("selectAliasName").innerText=zTreeObj.getCheckedNodes()[0].name;
		}else{
			$("#labelVal").val(zTreeObj.getSelectedNodes()[0].name);
		}
		$("#aliaslistxitong").modal("hide");
	}
}
function attention(info,type) {
	if(type ==1){
		$("#aliaslistxitong").modal("show");
	}else{
		$("#aliaslistgeren").modal("show");
	}
}
function saveAlias() {
	var aliasName;
	if(status=='false'){
		aliasName=$("#selectAliasName").text()
	}else{
		aliasName=$("#labelVal").val()
	}
console.log(aliasName)
	 $.ajax({
		type : 'POST',
		url : "/insertAlias",
		data : {
			aliasName : aliasName,
			fileId : $("#aliasFileId").val(),
			aliasType : $("#aliasType").val()
		},
		success : function(data) {
			if (data != 0 || data != " ") {
				search('/pageSearch');
				//$.showSuccessTimeout("添加标签成功");
				$("#aliasModel").modal("hide");
				addSuccess()
			} else {
				//$.showErr("已添加过");
				aliasErr()
			}
		}
	}) 
}
</script>
</head>

<body  >
<div id="box">
	<div class="form-group" id="selectdiv" style="margin: 5px 0px;">
		<button class="btn btn-default" type="button" id="inputadd" th:title="#{addSearch}">
			<i class="icon-plus"></i>
		</button>
		<button class="btn btn-white btn-default btn-round" type="button" id="search">
			<i class="icon-search"></i>
		</button>
		<button class="btn btn-white btn-default btn-round" type="button" id="twices" disabled="disabled" th:text="#{rsearch}"></button>
	</div>

	<div style="clear:both"></div>
	<div style="width: 100%;" id="div-dg">
	<div id="box" style="width: 100%;height: 100%;padding: 6px;">
	<div style="height:30px;margin-bottom: 2px;">
	<div id="ul"
			style="border: 1px solid #C2DDF2;background: #F1F9FD;width: 95%;height:30px;padding: 2px 0px 0px 5px; float: left;font-size: 14px;color: #000;">
			<span style="float: left;line-height: 25px;" th:text="#{record}"></span>
			<ul id="ulsearch"></ul>
		</div>
		<button type="button" class="btn btn-white btn-default" style="background: rgb(0, 133, 255);color: white;margin-left:5px;height:30px;border: none;display: none"
				 id="btn_down" onclick="downloadbtn()">
				<span th:text="#{download}"></span>
			</button>
	</div>
		
		<table id="tb_order" style="width: 100%;height: 80%;">

		</table>
			</div>
	</div>
	<!--二次查询-->
	<div class="modal fade" id="searchModel" tabindex="-1" role="dialog" style="">
		<div class="modal-dialog" style="width: 700px;">
			<div class="modal-content">
				<div class="modal-header" style="height: 50px;">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					<h4 class="modal-title" th:text="#{rsearch}">在结果中搜索</h4>
				</div>
				<div class="modal-body" style="padding: 0px 10px;">
					<div class="form-group">
						<div class="input-group col-xs-12" style="padding: 37px 0px;">
							<div class='input-group-btn'>
								<select id='search2Select' onchange="first2Sel(this)" class='new_input'
									style='width:auto;border: 1px solid #ccc;height: 33px;margin-right: 10px;'><option
										value='fileName' th:text="#{fileName}">文件名称</option>
									<option value='securityId' th:text="#{filesec}">文档密级</option>
									<option value='format' th:text="#{format}">格式</option>
									<option value='fileDate' th:text="#{date}">日期</option>
									<option value='alias' th:text="#{alias}">标签</option>
									<option value='item' th:text="#{item}">项目名</option>
									<!-- <option value='fullSearch'>全文检索</option> -->
								</select>
							</div>
							<select id='children' class='form-control' style='width:auto;display:none;'></select>
							<div id="menu" class="dropdown" style="float:left;display:none;margin-right: 5px;">
								<input type="text" id="alias2Id" style="display:none" /> <a id="alias2Text"
									data-toggle="dropdown" class="btn" data-target="#"
									style="color:#000;border: 1px solid #ccc;" th:text="#{label}">请选择标签<span class="caret"
									style="margin-left: 5px;color:#000"></span>
								</a>
								<ul id="categories" class="dropdown-menu"></ul>
							</div>
							<input type='text' class='new_input' style="width: 320px;border:1px;" th:placeholder='#{keyword}'
								id='search2Input' autocomplete='off' /> <input type='text' class='form-control'
								style='width: 300px;display:none;border-radius: 5px !important;' th:placeholder='#{pdate}'
								id='q2BeginTime' autocomplete='off'/>
							<button class="btn btn-default" type="button" id="listsearch">
								<i class="icon-search"></i>
							</button>
						</div>
					</div>
				</div>
			</div>
			<!-- /.modal-content -->
		</div>
		<!-- /.modal -->
	</div>
	<!--二次查询-->
<!--添加标签开始-->
		<div class="modal fade" id="aliasModel" tabindex="-1" role="dialog">
			<div class="modal-dialog">
				<div class="modal-content" style=" width: 440px;">
					<div class="modal-header" style="height: 50px;">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
						<h4 class="modal-title">添加标签</h4>
					</div>
					<div class="modal-body" style="padding: 0px 10px;">
						<div class="row">
							<div class="col-md-12" style="padding: 10px 0px;">
								<table id="tb_alias">
									<tr>
										<td><label style="margin-bottom: 15px;">创建新标签:</label></td>
										<td><input class="form-control" type="text" id="labelVal" autocomplete="off" style="display: inline; width: 180px;margin-bottom: 15px;" /></td>
									</tr>
									<tr>
										<td><span style="margin-bottom: 15px;font-weight: bolder;margin-bottom: 5px;">您选择的标签:</span></td>
										<td><span id="selectAliasName"></span></td>
									</tr>
									<tr id="aliasUser">
										<td><label>选择已有的标签:</label></td>
										<td><label id="myalias"></label></td>
									</tr>
									<tr>
										<td><input type="text" id="aliasFileId" style="display: none" /></td>
										<td><input type="text" id="aliasType" style="display: none" /></td>
									</tr>
								</table>
							</div>
						</div>
					</div>
					<div class="modal-footer" style="height: 70px;">
						<button type="button" class="btn new-tijiao queding" onclick="saveAlias()" th:text="#{submit}">保存</button>
					</div>
				</div>
				<!-- /.modal-content -->
			</div>
			<!-- /.modal -->
		</div>
		<!--添加标签结束-->
		<!--系统标签列表-->
		<div class="modal fade" id="aliaslistxitong" tabindex="-1" role="dialog">
			<div class="modal-dialog">
				<div class="modal-content" style=" width: 440px;">
					<div class="modal-header" style="height: 50px;">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
						<h4 class="modal-title">系统标签</h4>
					</div>
					<div class="modal-body" style="padding: 0px 10px;">
						<div class="row">
							<div class="col-md-12" style="padding: 10px 0px;">
								<ul id="systree" class="ztree" style="margin: 10px 0px 0px; padding: 0px; width: 100%; height: 45%; "></ul>
							</div>
						</div>
					</div>
				</div>
				<!-- /.modal-content -->
			</div>
			<!-- /.modal -->
		</div>
		<!--添加标签结束-->
		<!--系统标签列表-->
		<div class="modal fade" id="aliaslistgeren" tabindex="-1" role="dialog">
			<div class="modal-dialog">
				<div class="modal-content" style=" width: 440px;">
					<div class="modal-header" style="height: 50px;">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
						<h4 class="modal-title">个人标签</h4>
					</div>
					<div class="modal-body" style="padding: 0px 10px;">
						<div class="row">
							<div class="col-md-12" style="padding: 10px 0px;">
								<ul id="pertree" class="ztree" style="margin: 10px 0px 0px; padding: 0px; width: 100%; height: 45%;"></ul>
							</div>
						</div>
					</div>
				</div>
				<!-- /.modal-content -->
			</div>
			<!-- /.modal -->
		</div>
		<!--添加标签结束-->
		</div>
</body>
<script src="../assets/js/datetime.js"></script>
<script>
laydate.skin('molv');
	laydate({
		elem : "#q2BeginTime",
		format : 'YYYY-MM-DD',
		min : "1420-2-10", //设定最小日期为当前日期
		max : laydate.now()//最大日期
	});
	function downloadbtn() {
		var fileIdAll = [];
		var getSelectRows = $("#tb_order").bootstrapTable(
				'getSelections', function(row) {
					return row;
				});
		if (getSelectRows.length == 0) {
			nullErr();
		} else {
			for (i = 0; i < getSelectRows.length; i++) {
				fileIdAll.push(getSelectRows[i].fileId)
			}
			  if (getSelectRows.length == 1) {
				var param = {
					fileId : getSelectRows[0].fileId
				};
				window.location.href = "/download?fileId="
						+ getSelectRows[0].fileId;
				//$.get("/download", param, function(result) {});
			} else {
				window.location.href = "/downloadFiles?fileIds="+fileIdAll;
			}  
		}
	}
</script>
</html>